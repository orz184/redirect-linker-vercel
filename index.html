<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>分享連結 → jDownloader（免代理／不碰 lbxdl）</title>
  <style>
    body{font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans TC",sans-serif;line-height:1.6;margin:0;background:#0f1320;color:#e9eef6}
    .wrap{max-width:860px;margin:0 auto;padding:28px 18px}
    h1{font-size:20px;margin:0 0 10px}
    p.muted{color:#9aa4b2;margin:0 0 16px}
    .card{background:#121833;border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:16px;margin:16px 0}
    textarea{width:100%;min-height:160px;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,.15);background:#0f1733;color:#e9eef6}
    .row{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    button{appearance:none;border:0;border-radius:10px;padding:10px 14px;background:#4a8cff;color:#fff;cursor:pointer;font-weight:600}
    button.secondary{background:#2d3b66}
    .small{font-size:13px}
    code{background:rgba(255,255,255,.08);padding:2px 6px;border-radius:6px}
    .ok{color:#88f6b1}.warn{color:#ffb37a}.err{color:#ffa0a0}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>分享連結 → jDownloader</h1>
    <p class="muted">把分享連結直接送進你電腦上的 jDownloader LinkGrabber。<br>本頁不會連到 lbxdl，也不會幫你解析任何 JSON。</p>

    <div class="card">
      <p class="small">貼上分享連結（每行一條；原始分享頁或 <code>.../api/?token=...</code> 都可）：</p>
      <textarea id="links" placeholder="例如：&#10;https://lbxdl.22web.org/?s=XXXX&#10;https://lbxdl.22web.org/api/?token=YYYY"></textarea>
      <div class="row">
        <button id="sendJD">送到 jDownloader</button>
        <button id="clear" class="secondary">清空</button>
      </div>
      <p id="msg" class="small"></p>
    </div>

    <div class="card">
      <b>使用說明</b>
      <ul class="small">
        <li>這會向 <code>http://127.0.0.1:9666</code>（你的電腦）送資料；請先啟動 jDownloader。</li>
        <li>送出後，請到 jDownloader 的 <em>LinkGrabber</em> 分頁查看是否接收到連結，再開始下載。</li>
        <li>若你的瀏覽器是 HTTPS 網站頁面，向 <code>http://127.0.0.1</code> 發送表單通常是允許的（屬於可信本機）；若仍被阻擋，請改用其他瀏覽器或關閉阻擋設定。</li>
      </ul>
    </div>
  </div>

  <!-- 兩個隱藏表單：同時嘗試 /flash/add 與 /flashgot，提升相容性 -->
  <iframe name="cnl_iframe" style="display:none"></iframe>
  <form id="formAdd" action="http://127.0.0.1:9666/flash/add" method="post" target="cnl_iframe" style="display:none">
    <input type="hidden" name="urls" />
    <input type="hidden" name="package" value="Imported Links" />
    <input type="hidden" name="autostart" value="0" />
    <input type="hidden" name="source" value="your-web" />
  </form>
  <form id="formFlashGot" action="http://127.0.0.1:9666/flashgot" method="post" target="cnl_iframe" style="display:none">
    <input type="hidden" name="urls" />
    <input type="hidden" name="package" value="Imported Links" />
    <input type="hidden" name="autostart" value="0" />
    <input type="hidden" name="referer" value="" />
  </form>

  <script>
    const $ = (id)=>document.getElementById(id);
    const msg = $('msg');

    function normalizeInput(text){
      return text.split(/\r?\n/).map(s=>s.trim()).filter(Boolean);
    }

    function submitToJD(endpointId, urls){
      const form = $(endpointId);
      form.querySelector('input[name="urls"]').value = urls.join('\n');
      try { form.submit(); return true; } catch { return false; }
    }

    $('sendJD').onclick = () => {
      const links = normalizeInput($('links').value);
      if (!links.length) { msg.innerHTML = '<span class="warn">請先貼上至少一條分享連結。</span>'; return; }

      // 同時嘗試兩個相容端點
      const ok1 = submitToJD('formAdd', links);
      const ok2 = submitToJD('formFlashGot', links);

      if (ok1 || ok2) {
        msg.innerHTML = '<span class="ok">已送出到 jDownloader（LinkGrabber）。請切到 jDownloader 查看。</span>';
      } else {
        msg.innerHTML = '<span class="err">送出失敗。請確認 jDownloader 已啟動，且允許 Click’n’Load / FlashGot。</span>';
      }
    };

    $('clear').onclick = () => { $('links').value = ''; msg.textContent = ''; };
  </script>
</body>
</html>
